<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Live Message Wall</title>
  <style>
    body {
      margin: 0;
      background: #000;
      overflow: hidden;
      font-family: sans-serif;
    }

    .message {
      position: absolute;
      white-space: nowrap;
      color: white;
      font-weight: bold;
      pointer-events: none;
      animation: pulsate 2s ease-in-out infinite alternate;
      transition: opacity 1s;
    }

    @keyframes pulsate {
      from {
        transform: scale(1);
      }
      to {
        transform: scale(1.1);
      }
    }
  </style>
</head>
<body>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import { getDatabase, ref, onChildAdded } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-database.js";

    const firebaseConfig = {
    apiKey: "AIzaSyBCSmzABKJeCVTI67dHN6J0r8LsJTPizI8",
    authDomain: "criticalmassscreen.firebaseapp.com",
    databaseURL: "https://criticalmassscreen-default-rtdb.firebaseio.com",
    projectId: "criticalmassscreen",
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const messagesRef = ref(db, "messages");

    const activeMessages = [];

    onChildAdded(messagesRef, (snapshot) => {
      const message = snapshot.val();
      const timestamp = message.timestamp || 0;
      const age = Date.now() - timestamp;

      if (age > 3 * 60 * 60 * 1000) return;

      const el = createMessageElement(message.text);
      animateMessage(el);
      updateMessageStyles();

      setTimeout(() => {
        el.style.opacity = 0;
        setTimeout(() => {
          el.remove();
          const index = activeMessages.indexOf(el);
          if (index !== -1) activeMessages.splice(index, 1);
          updateMessageStyles();
        }, 1000);
      }, 3 * 60 * 60 * 1000);
    });

    function createMessageElement(text) {
      const el = document.createElement("div");
      el.className = "message";
      el.textContent = text;
      el.style.color = getRandomColor();
      document.body.appendChild(el);
      activeMessages.push(el);
      return el;
    }

    function updateMessageStyles() {
      const baseSize = Math.min(window.innerWidth, window.innerHeight) / 15;
      const minSize = 12;
      const count = activeMessages.length;
      const size = Math.max(minSize, baseSize - count * 0.4);

      activeMessages.forEach((el) => {
        el.style.fontSize = `${size}px`;
      });
    }

    function animateMessage(el) {
      const elWidth = 200; // estimated width for initial placement
      const elHeight = 30;
      let x = Math.random() * (window.innerWidth - elWidth);
      let y = Math.random() * (window.innerHeight - elHeight);
      let dx = (Math.random() - 0.5) * 2;
      let dy = (Math.random() - 0.5) * 2;

      function move() {
        const rect = el.getBoundingClientRect();
        const elW = rect.width;
        const elH = rect.height;

        x += dx;
        y += dy;

        if (x <= 0 || x + elW >= window.innerWidth) dx *= -1;
        if (y <= 0 || y + elH >= window.innerHeight) dy *= -1;

        el.style.left = x + "px";
        el.style.top = y + "px";

        requestAnimationFrame(move);
      }

      el.style.left = x + "px";
      el.style.top = y + "px";
      move();
    }

    function getRandomColor() {
      const colors = ["#ff0", "#0ff", "#f0f", "#0f0", "#f00", "#00f", "#fff"];
      return colors[Math.floor(Math.random() * colors.length)];
    }
  </script>
</body>
</html>
